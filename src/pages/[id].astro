---
import fs from "fs";
import path from "path";

interface Property {
  id: number;
  title: string;
  price: string;
  location: string;
  description: string;
  images: string | string[]; 
  rooms: number;
  bathrooms: number;
  type: string;
}

const { params } = Astro;
const id = parseInt(params.id ?? "0");

const filePath = path.resolve("./src/data/properties.json");
let properties: Property[] = [];

if (fs.existsSync(filePath)) {
  const fileData = fs.readFileSync(filePath, "utf-8");
  properties = JSON.parse(fileData) as Property[];
}

const property = properties.find((p: Property) => p.id === id);

// ×”×¤×•×š ××ª ×”×ª××•× ×” ×”×¨××©×™×ª ×œ××¢×¨×š ×‘××™×“×ª ×”×¦×•×¨×š
const images = property ? (Array.isArray(property.images) ? property.images : [property.images]) : [];
---

<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>{property ? property.title : "×“×™×¨×” ×œ× × ××¦××”"}</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body dir="rtl">
  <header class="property-header">
    <a href="/" class="back-btn">â¬… ×—×–×¨×” ×œ×¨×©×™××ª ×“×™×¨×•×ª</a>
  </header>

  <main class="property-container">
    {property ? (
      <>
        <!-- ×¦×“ ×©×××œ - ×’×œ×¨×™×” -->
        <div class="property-gallery">
          <img id="mainImage" src={images[0]} alt={property.title} class="main-image" />
          <div class="thumbs">
            {images.map((img, i) => (
              <img 
                src={img} 
                alt={`×ª××•× ×” ${i+1} ×©×œ ${property.title}`} 
                class="thumb" 
                onclick={`document.getElementById('mainImage').src='${img}'`}
              />
            ))}
          </div>
        </div>

        <!-- ×¦×“ ×™××™×Ÿ - ×¤×¨×˜×™× -->
        <div class="property-details">
          <h1>{property.title}</h1>
          <p class="price">××—×™×¨: {property.price} </p>
          <p><strong>××™×§×•×:</strong> {property.location}</p>
          <p class="desc">{property.description}</p>

          <ul class="info-list">
            <li>ğŸ› ××¡×¤×¨ ×—×“×¨×™×: {property.rooms}</li>
            <li>ğŸš¿ ×—×“×¨×™ ×××‘×˜×™×”: {property.bathrooms}</li>
            <li>ğŸ  ×¡×•×’ × ×›×¡: {property.type}</li>
          </ul>

          <div class="contact-box">
            <h3>××¢×•× ×™×™×Ÿ ×‘× ×›×¡ ×–×”?</h3>
            <p>×”×©××™×¨×• ×¤×¨×˜×™× ×•× ×—×–×•×¨ ××œ×™×›× ×‘×”×§×“×!</p>
            <form class="contact-form">
              <input type="text" name="name" placeholder="×©× ××œ×" required />
              <input type="email" name="email" placeholder="××™××™×™×œ" required />
              <input type="tel" name="phone" placeholder="×˜×œ×¤×•×Ÿ" required />
              <textarea name="message" placeholder="×”×•×“×¢×”"></textarea>
              <button type="submit">×©×œ×™×—×” ğŸ“©</button>
            </form>
          </div>
        </div>
      </>
    ) : (
      <p class="not-found">×“×™×¨×” ×–×• ×œ× ×§×™×™××ª.</p>
    )}
  </main>
</body>
</html>
