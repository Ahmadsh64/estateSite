---
import fs from "fs";
import path from "path";

const filePath = path.resolve("./src/data/properties.json");
let properties = [];

if (fs.existsSync(filePath)) {
  const fileData = fs.readFileSync(filePath, "utf-8");
  properties = JSON.parse(fileData);
}
---

<html lang="he">
  <head>
    <meta charset="UTF-8" />
    <title>× ×™×”×•×œ ×“×™×¨×•×ª</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body dir="rtl">
    <header>
      <h1>× ×™×”×•×œ ×“×™×¨×•×ª</h1>
      <nav>
        <a href="/admin/add">â• ×”×•×¡×¤×ª ×“×™×¨×” ×—×“×©×”</a>
        <a href="/">ğŸ  ×—×–×¨×” ×œ×“×£ ×”×¨××©×™</a>
      </nav>
    </header>

    <main>
      <table border="1" cellpadding="10" cellspacing="0">
        <thead>
          <tr>
            <th>×ª××•× ×”</th>
            <th>×›×•×ª×¨×ª</th>
            <th>××—×™×¨</th>
            <th>××™×§×•×</th>
            <th>×¤×¢×•×œ×•×ª</th>
          </tr>
        </thead>
        <tbody>
          
        {properties.map((p: { id: number; title: string; price: string; location: string; images: string }) => (
              <tr>
                <td>
                  <img src={p.images[0]} alt={p.title} width="100" />
                </td>
                <td>{p.title}</td>
                <td>{p.price}</td>
                <td>{p.location}</td>
                <td>
                  <a href={`/admin/edit/${p.id}`}>âœï¸ ×¢×¨×™×›×”</a>
                  <button type="button" onclick={`deleteProperty(${p.id})`}>
                    ğŸ—‘ï¸ ××—×™×§×”
                  </button>
                </td>
              </tr>
            ))
          }
        </tbody>
      </table>

      <script type="module">
        document.addEventListener("DOMContentLoaded", () => {
          window.deleteProperty = async function (id) {
            if (!confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×“×™×¨×” ×–×•?")) return;

            try {
              const res = await fetch(`/api/delete-property`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ id }),
              });

              const result = await res.json();
              if (result.success) {
                alert("×”×“×™×¨×” × ××—×§×” ×‘×”×¦×œ×—×”");
                location.reload();
              } else {
                alert("×©×’×™××” ×‘××—×™×§×”");
              }
            } catch (err) {
              console.error(err);
              alert("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª");
            }
          };
        });
      </script>
    </main>
  </body>
</html>
