---
import { supabase } from "../lib/supabaseClient";
import type { Property } from "../types/property";

let properties: Property[] = [];

const { data, error } = await supabase
  .from("properties")
  .select("*")
  .order("created_at", { ascending: false });

if (error) {
  console.error("×©×’×™××” ×‘×©×œ×™×¤×ª ×”×“×™×¨×•×ª:", error.message);
} else if (data) {
  properties = data.map((p: any) => ({
    id: p.id,
    title: p.title,
    price: p.price,
    location: {
      city: p.city || "",
      street: p.street || "",
      number: p.number || "",
      floor: p.floor || "",
    },
    description: p.description,
    images: p.images || [],
    occupancy: p.occupancy,
    bedrooms: p.bedrooms,
    beds: p.beds,
    bathrooms: p.bathrooms,
    kitchen: p.kitchen,
    washingMachine: p.washingMachine,
    wifi: p.wifi,
    tv: p.tv,
    publicTransportNearby: p.publicTransportNearby,
    parking: p.parking,
    checkInTime: p.checkInTime,
    checkOutTime: p.checkOutTime,
    minStayDays: p.minStayDays,
    type: p.type,
  }));
}

---
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>×¨×©×™××ª ×“×™×¨×•×ª</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body dir="rtl">
<header>
  <div class="logo">
    <img src="/images/logo.png" alt="×œ×•×’×• ×”×—×‘×¨×”" />
    <span>×—×‘×¨×ª ×“×™×¨×•×ª</span>
  </div>

  <nav>
    <a href="/">×›×œ ×”×“×™×¨×•×ª</a>
    <a href="/filter/price">×¢×“ 1,000,000 â‚ª</a>
    <a href="/filter/center">××¨×›×–</a>
    <a href="/filter/north">×¦×¤×•×Ÿ</a>
  </nav>

  <a href="/admin/login" class="admin-btn">×›× ×™×¡×ª ×× ×”×œ</a>
</header>

<section class="hero">
  <div class="overlay">
    <h1>×—×‘×¨×ª ×“×™×¨×•×ª - ×”×‘×™×ª ×”×—×“×© ×©×œ×š ××ª×—×™×œ ×›××Ÿ</h1>
    <p>××¦× ××ª ×”×“×™×¨×” ×”××•×©×œ××ª ××ª×•×š ×××•×ª × ×›×¡×™×</p>
    <form class="filters">
      <select name="transaction">
        <option value="">×¡×•×’ ×¢×¡×§×”</option>
        <option value="××›×™×¨×”">××›×™×¨×”</option>
        <option value="×”×©×›×¨×”">×”×©×›×¨×”</option>
      </select>

      <select name="location">
        <option value="">××–×•×¨</option>
        <option value="×¦×¤×•×Ÿ">×¦×¤×•×Ÿ</option>
        <option value="××¨×›×–">××¨×›×–</option>
        <option value="×“×¨×•×">×“×¨×•×</option>
      </select>

      <select name="rooms">
        <option value="">×—×“×¨×™×</option>
        <option value="2">2+</option>
        <option value="3">3+</option>
        <option value="4">4+</option>
        <option value="5">5+</option>
      </select>

      <button type="submit">×—×¤×© ğŸ”</button>
    </form>
  </div>
</section>

<main>
  <ul class="home-property-list">
    {properties.map((p: Property) => (
      <li class="home-property-item">
        <a href={`/${p.id}`}>
          <div class="home-property-images">
            <img src={p.images[0]} alt={p.title} />
          </div>
          <h2 class="home-property-title">{p.title}</h2>
          <p class="home-property-price">××—×™×¨: {p.price.toLocaleString("he-IL")}</p>
          <p class="home-property-location">
            {p.location.city}, {p.location.street} {p.location.number}
            {p.location.floor ? `, ×§×•××” ${p.location.floor}` : ""}
          </p>
          <p class="home-property-details">
            ×—×“×¨×™×: {p.bedrooms} | ××™×˜×•×ª: {p.beds} | ×©×™×¨×•×ª×™×: {p.bathrooms} | 
            ××˜×‘×—: {p.kitchen ? "âœ”ï¸" : "âŒ"} | ×›×‘×™×¡×”: {p.washingMachine ? "âœ”ï¸" : "âŒ"} | 
            ×•×•×™×¤×™: {p.wifi ? "âœ”ï¸" : "âŒ"} | ×˜×œ×•×•×™×–×™×”: {p.tv ? "âœ”ï¸" : "âŒ"} | 
            ×—× ×™×”: {p.parking ? "âœ”ï¸" : "âŒ"} | ×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª: {p.publicTransportNearby ? "âœ”ï¸" : "âŒ"}
          </p>
          <p class="home-property-check-times">
            ×›× ×™×¡×”: {p.checkInTime} | ×™×¦×™××”: {p.checkOutTime} | ××™× ×™××•× ×™××™×: {p.minStayDays}
          </p>
        </a>
      </li>
    ))}
  </ul>
</main>


</body>
</html>
