---
import fs from "fs";
import path from "path";

interface Property {
  id: number;
  title: string;
  price: number;
  location: {
    city: string;
    street: string;
    number: string;
    floor?: string;
  };
  description: string;
  images: string[];
  rooms: number;
  beds: number;
  bathrooms: number;
  type: string;
  hasKitchen: boolean;
  hasWashingMachine: boolean;
  hasWifi: boolean;
  hasTv: boolean;
  publicTransport: boolean;
  parking: boolean;
  checkIn: string;
  checkOut: string;
  minStay: number;
}

const { params } = Astro;
const id = parseInt(params.id ?? "0");

const filePath = path.resolve("./src/data/properties.json");
let properties: Property[] = [];

if (fs.existsSync(filePath)) {
  const fileData = fs.readFileSync(filePath, "utf-8");
  properties = JSON.parse(fileData) as Property[];
}

const property = properties.find((p: Property) => p.id === id);
const images = property ? (Array.isArray(property.images) ? property.images : [property.images]) : [];
---

<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>{property ? property.title : "דירה לא נמצאה"}</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body dir="rtl">
  <header class="detail-header">
    <a href="/" class="detail-back-btn">⬅ חזרה לרשימת דירות</a>
  </header>

  <main class="detail-container">
    {property ? (
      <>
        <!-- צד שמאל - גלריה -->
        <div class="detail-gallery">
          <img id="detailMainImage" src={images[0]} alt={property.title} class="detail-main-image" />
          <div class="detail-thumbs">
            {images.map((img, i) => (
              <img 
                src={img} 
                alt={`תמונה ${i+1} של ${property.title}`} 
                class="detail-thumb" 
                onclick={`document.getElementById('detailMainImage').src='${img}'`}
              />
            ))}
          </div>
        </div>

        <!-- צד ימין - פרטים -->
        <div class="detail-info">
          <h1 class="detail-title">{property.title}</h1>
          <p class="detail-price">מחיר: {property.price.toLocaleString("he-IL")}</p>

          <h3>מיקום:</h3>
          <p class="detail-location">{property.location.city}, {property.location.street} {property.location.number}{property.location.floor ? `, קומה ${property.location.floor}` : ""}</p>

          <p class="detail-description">{property.description}</p>

          <ul class="detail-info-list">
            <li>🛏 מספר חדרים: {property.rooms}</li>
            <li>🛌 מיטות: {property.beds}</li>
            <li>🚿 חדרי אמבטיה: {property.bathrooms}</li>
            <li>🏠 סוג נכס: {property.type}</li>
            <li>🍳 מטבח: {property.hasKitchen ? "כן" : "לא"}</li>
            <li>🧺 מכונת כביסה: {property.hasWashingMachine ? "כן" : "לא"}</li>
            <li>📶 Wi-Fi: {property.hasWifi ? "כן" : "לא"}</li>
            <li>📺 טלוויזיה: {property.hasTv ? "כן" : "לא"}</li>
            <li>🚌 תחבורה ציבורית בסביבה: {property.publicTransport ? "כן" : "לא"}</li>
            <li>🚗 חניה: {property.parking ? "כן" : "לא"}</li>
            <li>⏰ שעת כניסה: {property.checkIn}</li>
            <li>⏰ שעת יציאה: {property.checkOut}</li>
            <li>🗓 מינימום הזמנה בימים: {property.minStay}</li>
          </ul>

          <div class="detail-contact-box">
            <h3>מעוניין בנכס זה?</h3>
            <p>השאירו פרטים ונחזור אליכם בהקדם!</p>
            <form class="detail-contact-form">
              <input type="text" name="name" placeholder="שם מלא" required />
              <input type="email" name="email" placeholder="אימייל" required />
              <input type="tel" name="phone" placeholder="טלפון" required />
              <textarea name="message" placeholder="הודעה"></textarea>
              <button type="submit">שליחה 📩</button>
            </form>
          </div>
        </div>
      </>
    ) : (
      <p class="detail-not-found">דירה זו לא קיימת.</p>
    )}
  </main>
</body>
</html>
