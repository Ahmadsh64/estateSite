---
import fs from "fs";
import path from "path";

const filePath = path.resolve("./src/data/properties.json");
let properties = [];

if (fs.existsSync(filePath)) {
  const fileData = fs.readFileSync(filePath, "utf-8");
  properties = JSON.parse(fileData);
}
---

<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>× ×™×”×•×œ ×“×™×¨×•×ª - ×× ×”×œ</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body dir="rtl">
  <header class="admin-header">
    <h1 class="admin-title">× ×™×”×•×œ ×“×™×¨×•×ª</h1>
    <nav class="admin-nav">
      <a href="/admin/add" class="admin-add-btn">â• ×”×•×¡×¤×ª ×“×™×¨×” ×—×“×©×”</a>
      <a href="/" class="admin-home-btn">ğŸ  ×—×–×¨×” ×œ×“×£ ×”×¨××©×™</a>
    </nav>
  </header>

  <main class="admin-main">
    {properties.map((p: { id: number; title: string; price: number; location: string; images: string[] }) => (
      <div class="admin-property-card">
        <img src={p.images[0]} alt={p.title} class="admin-property-img"/>
        <div class="admin-property-info">
          <div>
            <h2 class="admin-property-title">{p.title}</h2>
            <p class="admin-property-price">{p.price.toLocaleString("he-IL")} â‚ª</p>
            <p class="admin-property-location">{p.location}</p>
          </div>
          <div class="admin-property-actions">
            <a href={`/admin/edit/${p.id}`} class="admin-edit-btn">âœï¸ ×¢×¨×™×›×”</a>
            <button type="button" class="admin-delete-btn" onclick={`deleteProperty(${p.id})`}>ğŸ—‘ï¸ ××—×™×§×”</button>
          </div>
        </div>
      </div>
    ))}
  </main>

  <script type="module">
    document.addEventListener("DOMContentLoaded", () => {
      window.deleteProperty = async function (id) {
        if (!confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×“×™×¨×” ×–×•?")) return;

        try {
          const res = await fetch(`/api/delete-property`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id }),
          });

          const result = await res.json();
          if (result.success) {
            alert("×”×“×™×¨×” × ××—×§×” ×‘×”×¦×œ×—×”");
            location.reload();
          } else {
            alert("×©×’×™××” ×‘××—×™×§×”");
          }
        } catch (err) {
          console.error(err);
          alert("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª");
        }
      };
    });
  </script>
</body>
</html>
